(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(t){if(t.ep)return;t.ep=!0;const r=s(t);fetch(t.href,r)}})();class g{constructor(){this.reset()}get level(){return Math.floor(this.lines*.1)}createPiece(){const s="IJLOSTZ"[Math.floor(Math.random()*7)],i={blocks:[],x:0,y:0};switch(s){case"I":i.blocks=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]];break;case"J":i.blocks=[[2,2,2],[0,0,2],[0,0,0]];break;case"L":i.blocks=[[3,0,0],[3,0,0],[3,3,0]];break;case"O":i.blocks=[[0,0,0,0],[0,4,4,0],[0,4,4,0],[0,0,0,0]];break;case"S":i.blocks=[[0,5,5],[5,5,0],[0,0,0]];break;case"T":i.blocks=[[6,6,6],[0,6,0],[0,0,0]];break;case"Z":i.blocks=[[7,7,0],[0,7,7],[0,0,0]];break;default:throw new Error("Что то пошло не так!")}return i.x=4,i.y=-2,i}getState(){const e=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];for(let s=0;s<this.playfield.length;s++){const i=this.playfield[s];for(let t=0;t<i.length;t++){const r=i[t];e[s][t]=r;const{y:n,x:o,blocks:c}=this.activPiece;for(let h=0;h<c.length;h++)for(let l=0;l<c[h].length;l++)c[h][l]&&n+h>=0&&(e[n+h][o+l]=c[h][l])}}return{score:this.score,level:this.level,lines:this.lines,nextPiece:this.nextPiece,isGameOwer:this.gameower,playfield:e}}reset(){this.score=0,this.lines=0,this.gameower=!1,this.playfield=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],this.activPiece=this.createPiece(),this.nextPiece=this.createPiece()}movePieceLeft(){this.activPiece.x-=1,this.hasCollision()&&(this.activPiece.x+=1)}movePieceRight(){this.activPiece.x+=1,this.hasCollision()&&(this.activPiece.x-=1)}movePieceDown(){if(this.activPiece.y+=1,this.hasCollision()){this.activPiece.y-=1,this.lockPiece();const e=this.clearLine();e&&this.updateScore(e),this.updatePieces()}}rotatePiece(e=!0){const s=this.activPiece.blocks,i=s.length,t=[];for(let r=0;r<i;r++)t[r]=new Array(i).fill(0);if(e)for(let r=0;r<i;r++)for(let n=0;n<i;n++)t[n][r]=s[i-1-r][n];else for(let r=0;r<i;r++)for(let n=0;n<i;n++)t[n][r]=s[r][i-1-n];this.activPiece.blocks=t,this.hasCollision()&&(this.activPiece.blocks=s)}hasCollision(){const e=this.playfield,{y:s,x:i,blocks:t}=this.activPiece;for(let r=0;r<t.length;r++)for(let n=0;n<t[r].length;n++)if(t[r][n]!==0&&s+r>=0&&(e[s+r]===void 0||e[s+r][i+n]===void 0||e[s+r][i+n]>=1))return!0;return!1}lockPiece(){const{y:e,x:s,blocks:i}=this.activPiece;for(let t=0;t<i.length;t++)for(let r=0;r<i[t].length;r++)e<0?this.gameower=!0:i[t][r]&&(this.playfield[e+t][s+r]=i[t][r])}updatePieces(){this.activPiece=this.nextPiece,this.nextPiece=this.createPiece()}clearLine(){let e=[],s=this.playfield;for(let i=s.length-1;i>=0;i--){const t=s[i];let r=!0;for(let n=0;n<t.length;n++)t[n]==0&&(r=!1);r&&(e.unshift(i),console.log(e))}for(let i=0;i<e.length;i++){const t=e[i];this.playfield.splice(t,1);const r=new Array(10);r.fill(0),this.playfield.unshift(r),this.lines+=1}return e.length}updateScore(e){this.score+=e*e*10,console.log("score = "+this.score)}}const P=()=>{const a=new Float32Array([-1,-1,1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1]),e=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]);return{positions:a,normals:e}},y=()=>{let a={};a.color="(0.0, 1.0, 0.0)",a.ambientIntensity="0.2",a.diffuseIntensity="0.8",a.specularIntensity="0.4",a.shininess="150.0",a.specularColor="(1.0, 1.0, 1.0)",a.isPhong="1";const e=`
            struct Uniforms {
                viewProjectionMatrix : mat4x4<f32>,
                modelMatrix : mat4x4<f32>,
                normalMatrix : mat4x4<f32>,  
                colorVertex : vec4<f32>              
            };
            @binding(0) @group(0) var<uniform> uniforms : Uniforms;

            struct Output {
                @builtin(position) Position : vec4<f32>,
                @location(0) vPosition : vec4<f32>,
                @location(1) vNormal : vec4<f32>,
                @location(2) vColor : vec4<f32>             
              
            };
          
            @vertex
            fn main(@location(0) position: vec4<f32>, @location(1) normal: vec4<f32>) -> Output {
                var output: Output;
                let mPosition:vec4<f32> = uniforms.modelMatrix * position;
                output.vPosition = mPosition;
                output.vNormal   =  uniforms.normalMatrix*normal;
                output.Position  = uniforms.viewProjectionMatrix * mPosition;
                output.vColor   =  uniforms.colorVertex;
                return output;
            }`,s=`
            struct Uniforms {
                lightPosition : vec4<f32>,
                eyePosition : vec4<f32>,
                color : vec4<f32>
            };
            @binding(1) @group(0) var<uniform> uniforms : Uniforms;

            @fragment
            fn main(@location(0) vPosition: vec4<f32>, @location(1) vNormal: vec4<f32>,@location(2) vColor: vec4<f32>) ->  @location(0) vec4<f32> {
               
              let N:vec3<f32> = normalize(vNormal.xyz);
                let L:vec3<f32> = normalize(uniforms.lightPosition.xyz - vPosition.xyz);
                let V:vec3<f32> = normalize(uniforms.eyePosition.xyz - vPosition.xyz);
                let H:vec3<f32> = normalize(L + V);
                let diffuse:f32 = 0.8 * max(dot(N, L), 0.0);
                var specular:f32;
                var isp:i32 = ${a.isPhong};
                if(isp == 1){
                    specular = ${a.specularIntensity} * pow(max(dot(V, reflect(-L, N)),0.0), ${a.shininess});
                } else {
                    specular = ${a.specularIntensity} * pow(max(dot(N, H),0.0), ${a.shininess});
                }
                let ambient:f32 = ${a.ambientIntensity};
                let finalColor:vec3<f32> = vColor.xyz * (ambient + diffuse) + vec3<f32>${a.specularColor}*specular;
                return vec4<f32>(finalColor, 1.0);
            }`;return{vertex:e,fragment:s}},b={playfield:[[7,2,3,4,5,6,7,0,1,1],[4,5,6,0,0,0,0,0,0,1],[0,5,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,1,1,1,0,0],[0,1,1,1,0,0,1,0,0,0],[0,0,0,0,0,0,2,0,0,0],[0,1,0,0,7,6,0,0,0,0],[0,0,0,0,0,5,2,0,0,0],[0,0,0,0,0,4,2,0,0,0],[0,0,0,0,0,3,2,2,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,1,1]]};class x{constructor(e,s,i,t,r,n){if(this.themes={pastel:{0:[.3,.3,.3],1:[.69,.92,.95],2:[.73,.87,.98],3:[1,.8,.74],4:[1,.98,.77],5:[.78,.9,.79],6:[.88,.75,.91],7:[1,.8,.82],border:[.82,.77,.91]},neon:{0:[.1,.1,.1],1:[0,1,1],2:[0,0,1],3:[1,.5,0],4:[1,1,0],5:[0,1,0],6:[.5,0,1],7:[1,0,0],border:[1,1,1]}},this.currentTheme=this.themes.pastel,this.CreateGPUBuffer=(o,c,h=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST)=>{const l=o.createBuffer({size:c.byteLength,usage:h,mappedAtCreation:!0});return new Float32Array(l.getMappedRange()).set(c),l.unmap(),l},this.Frame=()=>{let o=this.ctxWebGPU.getCurrentTexture().createView();const c=this.device.createTexture({size:[this.canvasWebGPU.width,this.canvasWebGPU.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});this.renderPassDescription={colorAttachments:[{view:o,loadValue:{r:0,g:0,b:0,a:0},storeOp:"store",loadOp:"clear"}],depthStencilAttachment:{view:c.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},this.renderPlayfild_WebGPU(this.state);const h=this.device.createCommandEncoder(),l=h.beginRenderPass(this.renderPassDescription);l.setPipeline(this.pipeline),l.setVertexBuffer(0,this.vertexBuffer),l.setVertexBuffer(1,this.normalBuffer);let u=this.uniformBindGroup_ARRAY_border.length;for(let d=0;d<u;d++)l.setBindGroup(0,this.uniformBindGroup_ARRAY_border[d]),l.draw(this.numberOfVertices);let v=this.uniformBindGroup_ARRAY.length;for(let d=0;d<v;d++)l.setBindGroup(0,this.uniformBindGroup_ARRAY[d]),l.draw(this.numberOfVertices);l.end(),this.device.queue.submit([h.finish()]),requestAnimationFrame(this.Frame)},this.CheckWebGPU=()=>{let o="Great, your current browser supports WebGPU!",c=!0;return navigator.gpu||(o=`Your current browser does not support WebGPU! Make sure you are on a system 
                         with WebGPU enabled. Currently, SPIR-WebGPU is only supported in  
                         <a href="https://www.google.com/chrome/canary/">Chrome canary</a>
                         with the flag "enable-unsafe-webgpu" enabled. See the 
                         <a href="https://github.com/gpuweb/gpuweb/wiki/Implementation-Status"> 
                         Implementation Status</a> page for more details.                   
                        `,c=!1),{result:c,description:o}},this.element=e,this.width=s,this.heigh=i,this.nextPieceContext=n,this.canvasWebGPU=document.createElement("canvas"),this.canvasWebGPU.id="canvaswebgpu",this.canvasWebGPU.style.position="absolute",this.canvasWebGPU.style.top="0",this.canvasWebGPU.style.left="0",this.canvasWebGPU.style.pointerEvents="none",this.canvasWebGPU.width=this.width,this.canvasWebGPU.height=this.heigh,this.ctxWebGPU=this.canvasWebGPU.getContext("webgpu"),this.isWebGPU=this.CheckWebGPU(),this.playfildBorderWidth=4,this.playfildX=this.playfildBorderWidth+1,this.playfildY=this.playfildBorderWidth+1,this.playfildWidth=this.width*2/3,this.playfildHeight=this.heigh,this.playfildInnerWidth=this.playfildWidth-this.playfildBorderWidth*2,this.playfildInnerHeight=this.playfildHeight-this.playfildBorderWidth*2-2,this.blockWidth=this.playfildInnerWidth/r,this.blockHeight=this.playfildInnerHeight/t,this.panelX=this.playfildWidth+10,this.panelY=0,this.panelWidth=this.width/3,this.panelHeight=this.heigh,this.state={playfield:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]]},this.blockData={},this.isWebGPU.result)this.element.appendChild(this.canvasWebGPU),this.preRender(),window.addEventListener("resize",this.resize.bind(this));else{let o=document.createElement("div");o.innerText=this.isWebGPU.description,this.element.appendChild(o)}}resize(){this.width=window.innerWidth,this.heigh=window.innerHeight,this.canvasWebGPU.width=this.width,this.canvasWebGPU.height=this.heigh;const e=window.devicePixelRatio||1,s=[this.canvasWebGPU.width*e,this.canvasWebGPU.height*e],i=navigator.gpu.getPreferredCanvasFormat();this.ctxWebGPU.configure({device:this.device,format:i,size:s,alphaMode:"premultiplied"}),glMatrix.mat4.identity(this.PROJMATRIX);let t=40*Math.PI/180;glMatrix.mat4.perspective(this.PROJMATRIX,t,this.canvasWebGPU.width/this.canvasWebGPU.height,1,150),this.vpMatrix=glMatrix.mat4.create(),glMatrix.mat4.identity(this.vpMatrix),glMatrix.mat4.multiply(this.vpMatrix,this.PROJMATRIX,this.VIEWMATRIX)}setTheme(e){this.currentTheme=this.themes[e],this.renderPlayfild_Border_WebGPU()}renderNextPiece(e){this.nextPieceContext.clearRect(0,0,this.nextPieceContext.canvas.width,this.nextPieceContext.canvas.height);const{blocks:s}=e,i=20,t=Object.values(this.currentTheme);s.forEach((r,n)=>{r.forEach((o,c)=>{if(o>0){const h=t[o];this.nextPieceContext.fillStyle=`rgb(${h[0]*255}, ${h[1]*255}, ${h[2]*255})`,this.nextPieceContext.fillRect(c*i,n*i,i,i)}})})}renderMainScreen(e){this.clearScreen(e),this.renderPlayfild_WebGPU(e),this.renderNextPiece(e.nextPiece),document.getElementById("score").textContent=e.score,document.getElementById("lines").textContent=e.lines,document.getElementById("level").textContent=e.level}clearScreen({lines:e,score:s}){let i=document.querySelector("#info1");i.innerHTML="Line :"+e+" Score :"+s;let t=document.querySelector("#info2");t.innerHTML="-----------------------------"}renderStartScreen(){let e=document.querySelector("#info1");e.innerHTML="Press ENTER to Start";let s=document.querySelector("#info2");s.innerHTML="-----------------------------"}renderPauseScreen(){let e=document.querySelector("#info1");e.innerHTML="Press ENTER to Resume";let s=document.querySelector("#info2");s.innerHTML="-----------------------------"}renderEndScreen({score:e}){document.getElementById("game-over").style.display="block"}async preRender(){const e=await navigator.gpu.requestAdapter();this.device=await e.requestDevice();const s=window.devicePixelRatio||1,i=[this.canvasWebGPU.width*s,this.canvasWebGPU.height*s],t=navigator.gpu.getPreferredCanvasFormat();this.ctxWebGPU.configure({device:this.device,format:t,size:i,alphaMode:"premultiplied"});const r=y(),n=P();this.numberOfVertices=n.positions.length/3,this.vertexBuffer=this.CreateGPUBuffer(this.device,n.positions),this.normalBuffer=this.CreateGPUBuffer(this.device,n.normals),this.pipeline=this.device.createRenderPipeline({label:"main pipeline",layout:"auto",vertex:{module:this.device.createShaderModule({code:r.vertex}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,format:"float32x3",offset:0}]},{arrayStride:12,attributes:[{shaderLocation:1,format:"float32x3",offset:0}]}]},fragment:{module:this.device.createShaderModule({code:r.fragment}),entryPoint:"main",targets:[{format:t}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),this.fragmentUniformBuffer=this.device.createBuffer({size:48,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.MODELMATRIX=glMatrix.mat4.create(),this.NORMALMATRIX=glMatrix.mat4.create(),this.VIEWMATRIX=glMatrix.mat4.create(),this.PROJMATRIX=glMatrix.mat4.create();let o=[0,-20,75],c=new Float32Array([-5,0,0]);glMatrix.mat4.identity(this.VIEWMATRIX),glMatrix.mat4.lookAt(this.VIEWMATRIX,o,[9,-20,0],[0,1,0]),glMatrix.mat4.identity(this.PROJMATRIX);let h=40*Math.PI/180;glMatrix.mat4.perspective(this.PROJMATRIX,h,this.canvasWebGPU.width/this.canvasWebGPU.height,1,150),this.vpMatrix=glMatrix.mat4.create(),glMatrix.mat4.identity(this.vpMatrix),glMatrix.mat4.multiply(this.vpMatrix,this.PROJMATRIX,this.VIEWMATRIX),this.device.queue.writeBuffer(this.fragmentUniformBuffer,0,new Float32Array(o)),this.device.queue.writeBuffer(this.fragmentUniformBuffer,16,c),this.device.queue.writeBuffer(this.fragmentUniformBuffer,32,new Float32Array(this.currentTheme[5]));let l=this.ctxWebGPU.getCurrentTexture().createView();const u=this.device.createTexture({size:[this.canvasWebGPU.width,this.canvasWebGPU.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});this.renderPassDescription={colorAttachments:[{view:l,loadValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:u.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},this.renderPlayfild_Border_WebGPU(),this.vertexUniformBuffer=this.device.createBuffer({size:b.playfield.length*10*256,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.Frame()}async renderPlayfild_WebGPU({playfield:e}){this.x+=.01;const s=e.length;this.uniformBindGroup_ARRAY=[];let i=0;for(let t=0;t<s;t++)for(let r=0;r<e[t].length;r++){if(!e[t][r])continue;let n=e[t][r],o=this.device.createBindGroup({label:"uniformBindGroup_next",layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.vertexUniformBuffer,offset:i,size:208}},{binding:1,resource:{buffer:this.fragmentUniformBuffer,offset:0,size:48}}]});glMatrix.mat4.identity(this.MODELMATRIX),glMatrix.mat4.identity(this.NORMALMATRIX),glMatrix.mat4.translate(this.MODELMATRIX,this.MODELMATRIX,[r*2.2,t*-2.2,0]),glMatrix.mat4.identity(this.NORMALMATRIX),glMatrix.mat4.invert(this.NORMALMATRIX,this.MODELMATRIX),glMatrix.mat4.transpose(this.NORMALMATRIX,this.NORMALMATRIX),this.device.queue.writeBuffer(this.vertexUniformBuffer,i+0,this.vpMatrix),this.device.queue.writeBuffer(this.vertexUniformBuffer,i+64,this.MODELMATRIX),this.device.queue.writeBuffer(this.vertexUniformBuffer,i+128,this.NORMALMATRIX),this.device.queue.writeBuffer(this.vertexUniformBuffer,i+192,new Float32Array(this.currentTheme[n])),this.uniformBindGroup_ARRAY.push(o),i+=256}}async renderPlayfild_Border_WebGPU(){const e={playfield:[[1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]]};this.x+=.01;const s=e.playfield.length,i=64*256;this.vertexUniformBuffer_border=this.device.createBuffer({size:i,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.uniformBindGroup_ARRAY_border=[];let t=0;for(let r=0;r<s;r++)for(let n=0;n<e.playfield[r].length;n++){if(!e.playfield[r][n])continue;let o=this.device.createBindGroup({label:"uniformBindGroup_next 635",layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.vertexUniformBuffer_border,offset:t,size:208}},{binding:1,resource:{buffer:this.fragmentUniformBuffer,offset:0,size:48}}]});glMatrix.mat4.identity(this.MODELMATRIX),glMatrix.mat4.identity(this.NORMALMATRIX),glMatrix.mat4.translate(this.MODELMATRIX,this.MODELMATRIX,[n*2.2-2,r*-2.2+2,0]),glMatrix.mat4.identity(this.NORMALMATRIX),glMatrix.mat4.invert(this.NORMALMATRIX,this.MODELMATRIX),glMatrix.mat4.transpose(this.NORMALMATRIX,this.NORMALMATRIX),this.device.queue.writeBuffer(this.vertexUniformBuffer_border,t+0,this.vpMatrix),this.device.queue.writeBuffer(this.vertexUniformBuffer_border,t+64,this.MODELMATRIX),this.device.queue.writeBuffer(this.vertexUniformBuffer_border,t+128,this.NORMALMATRIX),this.device.queue.writeBuffer(this.vertexUniformBuffer_border,t+192,new Float32Array(this.currentTheme.border)),this.uniformBindGroup_ARRAY_border.push(o),t+=256}}}class w{constructor(e,s,i){this.game=e,this.view=s,this.viewWebGPU=i,this.isPlaying=!1,this.gameLoopID=null,this.intervalID=null,document.addEventListener("keydown",this.handleKeyDown.bind(this)),this.play()}update(){this.game.movePieceDown(),this.updateView()}play(){this.isPlaying=!0,this.startTimer(),this.updateView(),this.gameLoop(this)}pause(){this.isPlaying=!1,this.stopTimer(),this.updateView(),this.view.renderPauseScreen()}startTimer(){const e=1e3-this.game.getState().level*100;this.intervalID||(this.intervalID=setInterval(()=>{this.update()},e>0?e:100))}stopTimer(){this.intervalID&&(clearInterval(this.intervalID),this.intervalID=null)}updateView(){const e=this.game.getState();e.isGameOwer?(this.view.renderEndScreen(e),this.isPlaying=!1):this.isPlaying?this.view.renderMainScreen(e):this.view.renderPauseScreen()}reset(){this.game.reset(),this.play()}handleKeyDown(e){const s=this.game.getState();switch(e.keyCode){case 13:s.isGameOwer?this.reset():this.isPlaying?this.pause():this.play();break;case 37:this.game.movePieceLeft(),this.updateView();break;case 38:this.game.rotatePiece(),this.updateView();break;case 39:this.game.movePieceRight(),this.updateView();break;case 40:this.game.movePieceDown(),this.updateView();break}}gameLoop(e){let s=0;const i=function(t){if(s||(s=t),Math.abs(t-s)>=1e3/30){const r=e.game.getState();e.viewWebGPU.state=r,s=t}if(e.isPlaying==!1)return 0;window.requestAnimationFrame(i)};i(0)}}const M=document.getElementById("ui-container");M.innerHTML=`
  <h1>TETRIS</h1>
  <div class="theme-buttons">
    <button id="pastel-theme">Pastel</button>
    <button id="neon-theme">Neon</button>
  </div>
  <div class="info-line">
    <p>SCORE</p>
    <p id="score">0</p>
  </div>
  <div class="info-line">
    <p>LINES</p>
    <p id="lines">0</p>
  </div>
  <div class="info-line">
    <p>LEVEL</p>
    <p id="level">0</p>
  </div>
  <div id="next-piece-container">
    <p>NEXT</p>
    <canvas id="next-piece-canvas" width="80" height="80"></canvas>
  </div>
  <div class="control-buttons">
    <button id="start-button">START</button>
    <button id="pause-button">PAUSE</button>
  </div>
  <div id="game-over">GAME OVER</div>
`;const p=new g,f=new x(document.body,window.innerWidth,window.innerHeight,20,10,document.getElementById("next-piece-canvas").getContext("2d")),m=new w(p,f,f);document.getElementById("pastel-theme").addEventListener("click",()=>{document.body.className="pastel-theme",f.setTheme("pastel")});document.getElementById("neon-theme").addEventListener("click",()=>{document.body.className="neon-theme",f.setTheme("neon")});document.getElementById("start-button").addEventListener("click",()=>{m.play()});document.getElementById("pause-button").addEventListener("click",()=>{m.pause()});window.game=p;window.view=f;window.controller=m;document.getElementById("pastel-theme").click();
