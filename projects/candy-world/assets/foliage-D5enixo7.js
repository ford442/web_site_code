import{M as q,A as U,D as X,a as F,O as N,B as W,I as _,b as K,C as A,c as k,d as m,G,S,e as J,T as Q,f as L,g as Z,V as $,h as O,i as j,j as tt,k as et,P as nt,l as at}from"./three-vendor-Cterq954.js";function y(n){return new F({color:n,metalness:0,roughness:.8,flatShading:!1})}const p={grass:y(8190976),flowerStem:y(2263842),flowerCenter:y(16775885),flowerPetal:[y(16738740),y(12211667),y(8900346)],lightBeam:new q({color:16777215,transparent:!0,opacity:0,side:X,blending:U,depthWrite:!1})},V=[];function I(n){V.length<3e3&&V.push(n)}let E=[];const B=new N,Y=1e3;function it(n,i=5e3){E=[];const t=.8,e=new W(.05,t,.05);e.translate(0,t/2,0);const a=p.grass||y(8190976),o=Math.ceil(i/Y);for(let s=0;s<o;s++){const l=Math.min(Y,i-s*Y),r=new _(e,a,l);r.instanceMatrix.setUsage(K),r.count=0,n.add(r),E.push(r)}return E}function ct(n,i,t){const e=E.find(s=>s.count<(s.instanceMatrix.count||0));if(!e)return;const a=e.count;B.position.set(n,i,t),B.rotation.y=Math.random()*Math.PI;const o=.8+Math.random()*.4;B.scale.set(o,o,o),B.updateMatrix(),e.setMatrixAt(a,B.matrix),e.count++,e.instanceMatrix.needsUpdate=!0}function R(n){return!n||n<50?0:Math.log2(n/55)*.1%1}function lt(n,i){if(n)if(i){const t=n.channelData;if(!t||t.length===0)return;const e=(h,f)=>{h.forEach((M,b)=>{const P=f+b%4,x=t[Math.min(P,t.length-1)],T=x?.trigger||0,C=x?.volume||0,H=x?.freq||0;if(H>0){let v=R(H);v=(v+b*.1)%1;const D=new A().setHSL(v,1,.5);M.emissive.lerp(D,.3)}else M.emissive.lerp(new A(2228292),.1);const g=.2+C*.5+T*1.5;M.emissiveIntensity=g})};e(p.flowerPetal,1),e(V,1);const a=(n.channelData||[])[1];if(a&&a.freq>0){let h=R(a.freq);h=(h+.5)%1;const f=new A().setHSL(h,1,.6);p.flowerCenter.emissive.lerp(f,.2)}else p.flowerCenter.emissive.lerp(new A(16775885),.1);p.flowerCenter.emissiveIntensity=.5+n.kickTrigger*2;const o=p.lightBeam,s=n.kickTrigger,r=.6+((n.channelData||[])[1]?.pan||0)*.1;o.color.setHSL(r,.8,.8);let c=0;for(let h of n.channelData||[])h.activeEffect>0&&(c=1);let u=s*.4;c&&(u+=Math.random()*.3),o.opacity=Math.max(0,Math.min(.8,u));const d=Math.max((n.channelData||[])[3]?.volume||0,(n.channelData||[])[4]?.volume||0),w=.6+d*.1;p.grass.emissive.setHSL(w,.8,.2),p.grass.emissiveIntensity=.2+d*.8}else{const t=e=>{e.forEach(a=>{a.emissive.setHex(0),a.emissiveIntensity=0})};t(p.flowerPetal),t(V),p.flowerCenter.emissive.setHex(0),p.flowerCenter.emissiveIntensity=0,p.grass.emissive.setHex(0),p.grass.emissiveIntensity=0,p.lightBeam.opacity=0}}function ht(n,i,t,e){const a=n.userData.animationOffset||0,o=n.userData.animationType||"sway",s=n.userData.type;let l=0,r=0,c=0,u=0,d=0,w=0;t&&(l=t.grooveAmount||0,r=t.kickTrigger||0,c=t.beatPhase||0,t.channelData&&(u=t.channelData[0]?.volume||0,d=Math.max(t.channelData[1]?.volume||0,t.channelData[2]?.volume||0),w=Math.max(t.channelData[3]?.volume||0,t.channelData[4]?.volume||0)));const h=o==="glowPulse"||s==="starflower"||o==="spin";let f=!1;h?f=!e:f=e;let M=f?1+l*8:.2,b=1,P=0,x=0;f&&((s==="tree"||s==="mushroom")&&(b=1+u*.3),(s==="flower"||s==="orb"||s==="starflower")&&(P=d*5),(s==="grass"||s==="vine"||s==="shrub")&&(x=w*2));const T=i+c*2,C=M+x;n.userData.originalY===void 0&&(n.userData.originalY=n.position.y);const H=n.userData.originalY;if(n.children.forEach(g=>{if(g.userData.isBeam){g.rotation.y+=.05+P*.01;const v=1+r*2;if(g.scale.setScalar(v),!e&&g.material&&g.material!==p.lightBeam){let D=r*.6;Math.random()>.8&&(D+=.2),g.material.opacity=D}else e&&(g.material.opacity=0)}if(g.userData.isWash){const v=1+Math.sin(i*2)*.2+r;if(g.scale.setScalar(v),!e&&g.material&&g.material!==p.lightBeam){let D=.2+r*.3;g.material.opacity=D}else e&&(g.material.opacity=0)}}),(s==="tree"||s==="mushroom")&&(b>1.01?n.scale.set(b,1/b,b):n.scale.set(1,1,1)),P>0&&(n.rotation.y+=P*.1),o==="sway"||o==="gentleSway"||o==="vineSway"||o==="spin"){const g=T+a;if(o==="vineSway")n.children.forEach((v,D)=>{v.rotation.z=Math.sin(g*2+D*.5)*.2*C});else{const v=s==="tree"?T:i+a,D=s==="tree"?1:2;o==="spin"?(n.rotation.y+=.02*C,n.rotation.z=Math.cos(i*.5+a)*.05*C):(n.rotation.z=Math.sin(v*D+a)*.05*C,n.rotation.x=Math.cos(v*D*.8+a)*.05*C)}}else if(o==="bounce")n.position.y=H+Math.sin(T*3+a)*.1*C,f&&r>.1&&(n.position.y+=r*.2);else if(o!=="glowPulse"){if(o==="float")n.position.y=H+Math.sin(i*1.5+a)*.2,!e&&r>.1&&n.scale.setScalar(1+r*.2);else if(o==="spring")n.scale.y=1+Math.sin(i*3+a)*.1*C+r*.5;else if(o==="rain"){const g=n.children[1];if(g){const v=g.geometry.attributes.position;for(let D=0;D<v.count;D++){let z=v.getY(D);z-=.1+r*.2,z<-2&&(z=0),v.setY(D,z)}v.needsUpdate=!0}}}}function ut(n={}){const{color:i=8190976,shape:t="tall"}=n,e=y(i);let a;if(t==="tall"){const s=.5+Math.random();a=new W(.05,s,.05),a.translate(0,s/2,0);const l=a.attributes.position;for(let r=0;r<l.count;r++){const c=l.getY(r);if(c>s*.5){const u=(c-s*.5)/(s*.5);l.setX(r,l.getX(r)+u*.1)}}}else if(t==="bushy"){const s=.2+Math.random()*.3;a=new k(.1,.05,s,8),a.translate(0,s/2,0)}a&&a.computeVertexNormals();const o=new m(a,e);return o.castShadow=!0,o.userData.type="grass",o.userData.animationType=t==="tall"?"sway":"bounce",o.userData.animationOffset=Math.random()*10,o}function mt(n={}){const{color:i=null,shape:t="simple"}=n,e=new G,a=.6+Math.random()*.4,o=new k(.05,.05,a,6);o.translate(0,a/2,0);const s=new m(o,p.flowerStem);s.castShadow=!0,e.add(s);const l=new G;l.position.y=a,e.add(l);const r=new S(.1,8,8),c=new m(r,p.flowerCenter);l.add(c);let u;if(i?(u=y(i),I(u)):u=p.flowerPetal[Math.floor(Math.random()*p.flowerPetal.length)],t==="simple"){const d=5+Math.floor(Math.random()*2),w=new J(.15,0);w.scale(1,.5,1);for(let h=0;h<d;h++){const f=h/d*Math.PI*2,M=new m(w,u);M.position.set(Math.cos(f)*.18,0,Math.sin(f)*.18),M.rotation.z=Math.PI/4,l.add(M)}}else if(t==="multi"){const d=8+Math.floor(Math.random()*4),w=new S(.12,8,8);for(let h=0;h<d;h++){const f=h/d*Math.PI*2,M=new m(w,u);M.position.set(Math.cos(f)*.2,Math.sin(h*.5)*.1,Math.sin(f)*.2),l.add(M)}}return e.userData.animationOffset=Math.random()*10,e.userData.animationType="sway",e.userData.type="flower",e}function ot(n={}){const{color:i=16766720,intensity:t=1.5}=n,e=new G,a=.6+Math.random()*.4,o=new k(.05,.05,a,6);o.translate(0,a/2,0);const s=new m(o,p.flowerStem);s.castShadow=!0,e.add(s);const l=new S(.2,16,16),r=new F({color:i,emissive:i,emissiveIntensity:t,roughness:.8});I(r);const c=new m(l,r);c.position.y=a,e.add(c);const u=new S(1.5,16,16),d=new m(u,p.lightBeam);return d.position.y=a,d.userData.isWash=!0,e.add(d),e.userData.animationType="glowPulse",e.userData.animationOffset=Math.random()*10,e.userData.type="flower",e}function dt(n={}){const{color:i=16740039}=n,t=new G,e=.7+Math.random()*.4,a=new k(.04,.04,e,6);a.translate(0,e/2,0);const o=new m(a,y(2263842));o.castShadow=!0,t.add(o);const s=new m(new S(.09,8,8),p.flowerCenter);s.position.y=e,t.add(s);const l=new L(.09,.2,6),r=y(i);I(r);const c=6+Math.floor(Math.random()*3);for(let h=0;h<c;h++){const f=new m(l,r),M=h/c*Math.PI*2;f.position.set(Math.cos(M)*.16,e,Math.sin(M)*.16),f.rotation.x=Math.PI*.5,f.rotation.z=M,t.add(f)}const u=new L(.02,8,8,1,!0);u.translate(0,4,0);const d=p.lightBeam.clone();d.color.setHex(i);const w=new m(u,d);return w.position.y=e,w.userData.isBeam=!0,t.add(w),t.userData.animationType="spin",t.userData.animationOffset=Math.random()*10,t.userData.type="starflower",t}function wt(n={}){const{color:i=16738740}=n,t=new G,e=1+Math.random()*.5,a=new k(.1,.12,e,8),o=new m(a,y(7048739));o.position.y=e/2,o.castShadow=!0,t.add(o);const s=.4+Math.random()*.2,l=new S(s,16,16),r=y(i);I(r);const c=new m(l,r);c.position.y=e,c.castShadow=!0,t.add(c);const u=4+Math.floor(Math.random()*4),d=new S(s*.3,8,8),w=y(i+1118481);I(w);for(let h=0;h<u;h++){const f=new m(d,w),M=Math.random(),b=Math.random(),P=2*Math.PI*M,x=Math.acos(2*b-1),T=Math.sin(x)*Math.cos(P),C=Math.sin(x)*Math.sin(P),H=Math.cos(x);f.position.set(T*s,e+C*s,H*s),t.add(f)}return t.userData.animationType="sway",t.userData.animationOffset=Math.random()*10,t.userData.type="flower",t}function ft(n={}){const{color:i=64154}=n,t=new G;class e extends Z{scale;constructor(h=1){super(),this.scale=h}getPoint(h,f=new $){const M=Math.cos(h*Math.PI*4)*.2*h*this.scale,b=h*2*this.scale,P=Math.sin(h*Math.PI*4)*.2*h*this.scale;return f.set(M,b,P)}}const a=new e(1+Math.random()*.5),o=new Q(a,20,.08,8,!1),s=y(i);I(s);const l=new m(o,s);l.castShadow=!0,t.add(l);const r=new S(.15,8,8),c=new F({color:16777215,emissive:16775885,emissiveIntensity:.5,roughness:.5});I(c);const u=new m(r,c),d=a.getPoint(1);return u.position.copy(d),t.add(u),t.userData.animationType="spring",t.userData.animationOffset=Math.random()*10,t.userData.type="shrub",t}function pt(n={}){const{color:i=16738740}=n,t=new G,e=3+Math.random()*2,a=new k(.3,.5,e,16),o=new m(a,y(9132587));o.position.y=e/2,o.castShadow=!0,t.add(o);const s=y(i);I(s);const l=5+Math.floor(Math.random()*5);for(let r=0;r<l;r++){const c=new S(.8+Math.random()*.4,16,16),u=new m(c,s);u.position.set((Math.random()-.5)*2,e+Math.random()*1.5,(Math.random()-.5)*2),u.castShadow=!0,t.add(u)}return t.userData.animationType="gentleSway",t.userData.animationOffset=Math.random()*10,t.userData.type="tree",t}function Mt(n={}){const{color:i=3329330}=n,t=new G,e=new S(1+Math.random()*.5,16,16),a=new m(e,y(i));a.position.y=.5,a.castShadow=!0,t.add(a);const o=y(16738740);I(o);const s=3+Math.floor(Math.random()*3);for(let l=0;l<s;l++){const r=new S(.2,8,8),c=new m(r,o);c.position.set((Math.random()-.5)*1.5,1+Math.random()*.5,(Math.random()-.5)*1.5),t.add(c)}return t.userData.animationType="bounce",t.userData.animationOffset=Math.random()*10,t.userData.type="shrub",t}function yt(n={}){const{color:i=9055202}=n,t=new G,e=2.5+Math.random(),a=new k(.4,.6,e,12),o=new m(a,y(6111287));o.position.y=e/2,o.castShadow=!0,t.add(o);const s=6+Math.floor(Math.random()*4),l=y(i);I(l);for(let r=0;r<s;r++){const c=new G;c.position.y=e*.9,c.rotation.y=r/s*Math.PI*2;const u=1.5+Math.random(),d=new O(.2,u,8,16),w=new m(d,l);w.position.set(.5,-u/2,0),w.rotation.z=-Math.PI/6,c.add(w),t.add(c)}return t.userData.animationType="gentleSway",t.userData.animationOffset=Math.random()*10,t.userData.type="tree",t}function gt(n={}){const i=new G,t=y(6111287),e=1+Math.random()*.5,a=new k(.15,.2,e,8);a.translate(0,e/2,0);const o=new m(a,t);o.castShadow=!0,i.add(o);const s=3+Math.floor(Math.random()*3),l=[16711765,16755200,52479,16711935,65416];for(let r=0;r<s;r++){const c=new G;c.position.y=e*.8,c.rotation.y=r/s*Math.PI*2,c.rotation.z=Math.PI/4;const u=.8+Math.random()*.5,d=new k(.08,.1,u,6);d.translate(0,u/2,0);const w=new m(d,t);c.add(w);const h=new G;h.position.y=u;const f=l[Math.floor(Math.random()*l.length)],M=new F({color:f,roughness:.7,emissive:0,emissiveIntensity:0});I(M);const b=new j(.25,.08,64,8,2,3),P=new m(b,M);P.scale.set(1,.6,1),h.add(P);const x=new S(.15,16,16),T=new m(x,M);T.position.y=.05,h.add(T);const C=new S(1.2,16,16),H=p.lightBeam.clone();H.color.setHex(f);const g=new m(C,H);g.userData.isWash=!0,h.add(g),c.add(h),i.add(c)}return i.userData.animationType="sway",i.userData.animationOffset=Math.random()*10,i.userData.type="flower",i}function vt(n={}){const{color:i=11584734,rainIntensity:t=50}=n,e=new G,a=new S(1.5,16,16),o=y(i),s=new m(a,o);s.castShadow=!0,e.add(s);const l=new tt,r=t,c=new Float32Array(r*3);for(let w=0;w<r;w++)c[w*3]=(Math.random()-.5)*3,c[w*3+1]=Math.random()*-2,c[w*3+2]=(Math.random()-.5)*3;l.setAttribute("position",new et(c,3));const u=new nt({color:8900331,size:.05}),d=new at(l,u);return e.add(d),e.userData.animationType="rain",e.userData.animationOffset=Math.random()*10,e.userData.type="cloud",e}function Gt(n,i){const t=new G;t.position.set(n,0,i);for(let e=0;e<5;e++){const a=ot();a.position.set(Math.random()*2-1,0,Math.random()*2-1),t.add(a)}return t}function st(n={}){const{color:i=8900331,size:t=.5}=n,e=new S(t,16,16),a=new F({color:i,emissive:i,emissiveIntensity:.8});I(a);const o=new m(e,a);return o.castShadow=!0,o.userData.animationType="float",o.userData.animationOffset=Math.random()*10,o.userData.type="orb",o}function Dt(n,i){const t=new G;t.position.set(n,5,i);for(let e=0;e<3;e++){const a=st();a.position.set(Math.random()-.5,Math.random()-.5,Math.random()-.5),t.add(a)}return t}function St(n={}){const{color:i=16729344}=n,t=new G,e=5+Math.floor(Math.random()*5),a=y(i);I(a);for(let o=0;o<e;o++){const s=.3+Math.random()*.4,l=new S(s,16,16),r=new m(l,a);r.position.set((Math.random()-.5)*.8,s+Math.random()*.8,(Math.random()-.5)*.8),r.castShadow=!0,t.add(r)}return t.userData.animationType="bounce",t.userData.animationOffset=Math.random()*10,t.userData.type="shrub",t}export{ct as a,mt as b,vt as c,pt as d,Mt as e,Gt as f,Dt as g,yt as h,it as i,wt as j,gt as k,ft as l,dt as m,St as n,ht as o,ut as p,lt as u};
