(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const c=[{name:"Ruby",hex:"#FF0055",glow:"rgba(255, 0, 85, 0.6)"},{name:"Emerald",hex:"#00FF66",glow:"rgba(0, 255, 102, 0.6)"},{name:"Sapphire",hex:"#00CCFF",glow:"rgba(0, 204, 255, 0.6)"},{name:"Amethyst",hex:"#CC00FF",glow:"rgba(204, 0, 255, 0.6)"},{name:"Amber",hex:"#FFAA00",glow:"rgba(255, 170, 0, 0.6)"}],n={lanes:7,baseGrowthRate:.13,sporeExpandRate:8,penaltyGrowth:40,matchShrink:150},u={ctx:null,init:function(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume()},playTone:function(h,t,e,a=.1){if(!this.ctx)return;const i=this.ctx.createOscillator(),s=this.ctx.createGain();i.type=t,i.frequency.setValueAtTime(h,this.ctx.currentTime),s.gain.setValueAtTime(a,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+e),i.connect(s),s.connect(this.ctx.destination),i.start(),i.stop(this.ctx.currentTime+e)},shoot:function(){if(!this.ctx)return;const h=this.ctx.createOscillator(),t=this.ctx.createGain();h.connect(t),t.connect(this.ctx.destination),h.type="sine",h.frequency.setValueAtTime(800,this.ctx.currentTime),h.frequency.exponentialRampToValueAtTime(100,this.ctx.currentTime+.2),t.gain.setValueAtTime(.1,this.ctx.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.2),h.start(),h.stop(this.ctx.currentTime+.2)},match:function(){if(!this.ctx)return;const h=400+Math.random()*200;[h,h*1.25,h*1.5].forEach((t,e)=>{setTimeout(()=>{this.playTone(t,"sine",.6,.1)},e*50)})},mismatch:function(){if(!this.ctx)return;const h=this.ctx.createOscillator(),t=this.ctx.createGain();h.connect(t),t.connect(this.ctx.destination),h.type="sawtooth",h.frequency.setValueAtTime(150,this.ctx.currentTime),h.frequency.linearRampToValueAtTime(50,this.ctx.currentTime+.3),t.gain.setValueAtTime(.1,this.ctx.currentTime),t.gain.linearRampToValueAtTime(.01,this.ctx.currentTime+.3),h.start(),h.stop(this.ctx.currentTime+.3)},gameOver:function(){if(!this.ctx)return;const h=this.ctx.createOscillator(),t=this.ctx.createGain();h.connect(t),t.connect(this.ctx.destination),h.type="triangle",h.frequency.setValueAtTime(300,this.ctx.currentTime),h.frequency.exponentialRampToValueAtTime(10,this.ctx.currentTime+2),t.gain.setValueAtTime(.3,this.ctx.currentTime),t.gain.linearRampToValueAtTime(.01,this.ctx.currentTime+2),h.start(),h.stop(this.ctx.currentTime+2)}};class T{constructor(t,e,a,i){this.lane=t,this.type=e,this.height=a,this.colorIdx=i,this.flash=0,this.shapeSeed=Math.random()}update(t){this.height+=t,this.flash>0&&(this.flash-=.1)}}class v{constructor(t,e,a,i){this.x=t,this.y=e,this.lane=a,this.radius=10,this.colorIdx=i,this.active=!0}update(t,e,a,i){if(!this.active)return;this.radius+=n.sporeExpandRate;const s=t.find(l=>l.lane===this.lane&&l.type==="top"),r=t.find(l=>l.lane===this.lane&&l.type==="bottom");if(!s||!r)return;const g=this.y-this.radius<s.height,y=this.y+this.radius>e-r.height;let m=!1;g&&(m=!0,this.colorIdx===s.colorIdx?(u.match(),s.height=Math.max(10,s.height-n.matchShrink),s.flash=1,a(this.x,s.height,c[this.colorIdx].hex,20),i(10),s.colorIdx=Math.floor(Math.random()*c.length)):(u.mismatch(),s.height+=n.penaltyGrowth,a(this.x,s.height,"#555",5))),y&&(m=!0,this.colorIdx===r.colorIdx?(u.match(),r.height=Math.max(10,r.height-n.matchShrink),r.flash=1,a(this.x,e-r.height,c[this.colorIdx].hex,20),i(10),r.colorIdx=Math.floor(Math.random()*c.length)):(u.mismatch(),r.height+=n.penaltyGrowth,a(this.x,e-r.height,"#555",5))),m&&(this.active=!1)}}class A{constructor(t,e,a){this.x=t,this.y=e,this.vx=(Math.random()-.5)*10,this.vy=(Math.random()-.5)*10,this.life=1,this.color=a,this.size=Math.random()*4+1}update(){this.x+=this.vx,this.y+=this.vy,this.life-=.02}}class C{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.width=t.width,this.height=t.height,this.laneWidth=this.width/n.lanes}resize(t,e){this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,this.laneWidth=t/n.lanes}clear(){this.ctx.clearRect(0,0,this.width,this.height)}draw(t){this.ctx&&(this.clear(),this.drawGuides(),t.crystals.forEach(e=>this.drawComplexCrystal(e)),this.drawCursor(t),t.spores.forEach(e=>this.drawSpore(e)),t.particles.forEach(e=>this.drawParticle(e)))}drawGuides(){this.ctx.strokeStyle="rgba(255, 255, 255, 0.05)",this.ctx.lineWidth=1;for(let t=1;t<n.lanes;t++){const e=t*this.laneWidth;this.ctx.beginPath(),this.ctx.moveTo(e,0),this.ctx.lineTo(e,this.height),this.ctx.stroke()}}drawCursor(t){if(!t.active)return;const e=t.mouseLane*this.laneWidth+this.laneWidth/2;this.ctx.beginPath(),this.ctx.setLineDash([5,15]),this.ctx.moveTo(e,0),this.ctx.lineTo(e,this.height),this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.beginPath(),this.ctx.arc(e,this.height/2,8,0,Math.PI*2),this.ctx.fillStyle="#fff",this.ctx.fill()}drawSpore(t){const e=c[t.colorIdx];this.ctx.shadowBlur=30,this.ctx.shadowColor=e.hex;const a=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius);a.addColorStop(0,"#fff"),a.addColorStop(.3,e.hex),a.addColorStop(1,"transparent"),this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius*.4,0,Math.PI*2),this.ctx.fillStyle="#fff",this.ctx.fill(),this.ctx.shadowBlur=0}drawParticle(t){this.ctx.globalAlpha=t.life,this.ctx.shadowBlur=10*t.life,this.ctx.shadowColor=t.color,this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1}drawComplexCrystal(t){const e=t.lane*this.laneWidth+this.laneWidth/2,a=this.laneWidth*.8,i=c[t.colorIdx],s=t.shapeSeed;t.flash>0?(this.ctx.shadowBlur=30*t.flash,this.ctx.shadowColor="white",this.ctx.fillStyle="#fff",this.ctx.strokeStyle="#fff"):(this.ctx.shadowBlur=25,this.ctx.shadowColor=i.glow,this.ctx.strokeStyle="rgba(255,255,255,0.6)"),this.ctx.lineWidth=1.5,this.ctx.lineJoin="round";const r=(g,y,m,l)=>{const w=t.height*y,x=a*m/2,d=t.type==="top"?0:this.height,f=t.type==="top"?w:this.height-w,o=e+g,p=this.ctx.createLinearGradient(o,d,o,f);t.flash>0?(p.addColorStop(0,"#fff"),p.addColorStop(1,"#fff")):(p.addColorStop(0,i.hex),p.addColorStop(1,"rgba(0,0,0,0.1)")),this.ctx.fillStyle=p,this.ctx.beginPath(),t.type==="top"?(this.ctx.moveTo(o-x,d),this.ctx.lineTo(o+l,f),this.ctx.lineTo(o+x,d)):(this.ctx.moveTo(o-x,d),this.ctx.lineTo(o+l,f),this.ctx.lineTo(o+x,d)),this.ctx.fill(),this.ctx.stroke(),t.flash<.5&&(this.ctx.fillStyle="rgba(255,255,255,0.2)",this.ctx.beginPath(),this.ctx.moveTo(o-x*.5,d),t.type==="top"?this.ctx.lineTo(o+l*.5,f*.8):this.ctx.lineTo(o+l*.5,this.height-(this.height-f)*.8),this.ctx.lineTo(o+x*.5,d),this.ctx.fill())};s>.3&&r(-a*.35,.6,.4,-5),s<.7&&r(a*.35,.5,.4,5),r(0,1,.6,0),this.ctx.shadowBlur=0}}const S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=";class I{constructor(){this.image=document.createElement("img"),this.image.src=S,this.image.id="backgroundImage",this.image.style.position="absolute",this.image.style.top="0",this.image.style.left="0",this.image.style.width="100%",this.image.style.height="100%",this.image.style.objectFit="cover",this.image.style.zIndex="-1",this.image.style.pointerEvents="none";const t=document.getElementById("gameContainer");getComputedStyle(t).position==="static"&&(t.style.position="relative"),t.firstChild?t.insertBefore(this.image,t.firstChild):t.appendChild(this.image)}}class M{constructor(){this.background=new I,this.canvas=document.getElementById("gameCanvas"),this.renderer=new C(this.canvas),this.ui={start:document.getElementById("startScreen"),gameOver:document.getElementById("gameOverScreen"),score:document.getElementById("scoreVal"),finalScore:document.getElementById("finalScore"),level:document.getElementById("levelVal"),preview:document.getElementById("nextSporePreview"),startBtn:document.getElementById("startBtn"),restartBtn:document.getElementById("restartBtn")},this.state={active:!1,score:0,level:1,lastTime:0,crystals:[],spores:[],particles:[],nextSporeColorIdx:0,mouseLane:3,growthMultiplier:1},this.bindEvents(),this.resize(),requestAnimationFrame(this.loop.bind(this))}bindEvents(){this.ui.startBtn.addEventListener("click",()=>this.startGame()),this.ui.restartBtn.addEventListener("click",()=>this.resetGame()),window.addEventListener("resize",()=>this.resize()),window.addEventListener("mousemove",t=>this.handleMouseMove(t)),window.addEventListener("mousedown",t=>this.handleInput(t)),window.addEventListener("touchstart",t=>this.handleTouch(t))}resize(){this.renderer.resize(window.innerWidth,window.innerHeight)}startGame(){u.init(),this.state.active=!0,this.state.score=0,this.state.level=1,this.state.growthMultiplier=1,this.state.crystals=[],this.state.spores=[],this.state.particles=[],this.state.nextSporeColorIdx=Math.floor(Math.random()*c.length),this.ui.start.classList.add("hidden"),this.ui.gameOver.classList.add("hidden"),this.updateUI(),this.initCrystals()}resetGame(){this.startGame()}initCrystals(){for(let t=0;t<n.lanes;t++)this.state.crystals.push(new T(t,"top",20+Math.random()*60,Math.floor(Math.random()*c.length))),this.state.crystals.push(new T(t,"bottom",20+Math.random()*60,Math.floor(Math.random()*c.length)))}handleMouseMove(t){if(!this.state.active)return;const e=Math.floor(t.clientX/this.renderer.laneWidth);this.state.mouseLane=Math.min(Math.max(0,e),n.lanes-1)}handleInput(t){this.state.active&&this.shootSpore()}handleTouch(t){if(!this.state.active)return;const e=t.touches[0].clientX,a=Math.floor(e/this.renderer.laneWidth);this.state.mouseLane=Math.min(Math.max(0,a),n.lanes-1),this.shootSpore()}shootSpore(){u.shoot();const t=this.state.nextSporeColorIdx,e=this.state.mouseLane*this.renderer.laneWidth+this.renderer.laneWidth/2,a=this.renderer.height/2;this.state.spores.push(new v(e,a,this.state.mouseLane,t)),this.state.nextSporeColorIdx=Math.floor(Math.random()*c.length),this.updateUI()}createParticles(t,e,a,i=10){for(let s=0;s<i;s++)this.state.particles.push(new A(t,e,a))}update(t){this.state.growthMultiplier=1+this.state.score/500;const e=n.baseGrowthRate*this.state.growthMultiplier;let a=!1;if(this.state.crystals.forEach(i=>{i.update(e);const s=this.state.crystals.find(r=>r.lane===i.lane&&r.type!==i.type);s&&i.height+s.height>=this.renderer.height&&(a=!0)}),a){this.state.active=!1,u.gameOver(),this.ui.finalScore.innerText=this.state.score,this.ui.gameOver.classList.remove("hidden");return}for(let i=this.state.spores.length-1;i>=0;i--){let s=this.state.spores[i];s.update(this.state.crystals,this.renderer.height,this.createParticles.bind(this),r=>{this.state.score+=r}),s.active||(this.state.spores.splice(i,1),this.updateUI())}for(let i=this.state.particles.length-1;i>=0;i--){let s=this.state.particles[i];s.update(),s.life<=0&&this.state.particles.splice(i,1)}}updateUI(){this.ui.score.innerText=this.state.score,this.ui.level.innerText=Math.floor(this.state.score/500)+1;const t=c[this.state.nextSporeColorIdx];this.ui.preview.style.backgroundColor=t.hex,this.ui.preview.style.boxShadow=`0 0 20px ${t.hex}`}loop(t){this.state.lastTime||(this.state.lastTime=t);const e=t-this.state.lastTime;this.state.active&&this.update(e),this.renderer.draw(this.state),this.state.lastTime=t,requestAnimationFrame(this.loop.bind(this))}}window.addEventListener("DOMContentLoaded",()=>{new M});
